[tox]
envlist = py38, py39, py310, py311, py312
isolated_build = True
minversion = 4.0

[testenv]
deps =
    pytest>=7.0
    pytest-cov>=4.0
    pytest-mock>=3.10
    pytest-xdist>=3.0
    factory-boy>=3.2
    faker>=18.0
    hypothesis>=6.0
    mutmut>=2.0
    pytest-benchmark>=4.0
    pytest-profiling>=1.7
    coverage[toml]>=7.0
    pytest-html>=3.1
    pytest-json-report>=1.5
    responses>=0.23
    httpretty>=1.1
    freezegun>=1.2
    pytest-freezegun>=0.4
    bandit>=1.7
    safety>=2.0
    locust>=2.15
    memory-profiler>=0.60
    psutil>=5.9
commands =
    pytest {posargs:tests/} --cov=aiailint --cov-report=term-missing --cov-report=html:htmlcov --cov-report=xml:coverage.xml --cov-fail-under=80
    bandit -r ../../../aiailint/src/ -f json -o bandit-report.json || true
    safety check --json --output safety-report.json || true

[testenv:lint]
deps =
    black>=23.0
    flake8>=6.0
    mypy>=1.0
    isort>=5.12
    bandit>=1.7
commands =
    black --check --diff ../../../aiailint/src/
    isort --check-only --diff ../../../aiailint/src/
    flake8 ../../../aiailint/src/
    mypy ../../../aiailint/src/ --ignore-missing-imports --no-strict-optional
    bandit -r ../../../aiailint/src/ -f json -o bandit-report.json

[testenv:format]
deps =
    black>=23.0
    isort>=5.12
commands =
    black ../../../aiailint/src/
    isort ../../../aiailint/src/

[testenv:security]
deps =
    bandit>=1.7
    safety>=2.0
commands =
    bandit -r ../../../aiailint/src/ -f json -o bandit-report.json
    safety check --json --output safety-report.json

[testenv:docs]
deps =
    sphinx>=6.0
    sphinx-rtd-theme>=1.2
    myst-parser>=1.0
commands =
    sphinx-build -b html docs/ docs/_build/html
    sphinx-build -b linkcheck docs/ docs/_build/linkcheck

[testenv:build]
deps =
    build>=0.10
    setuptools>=61.0
    wheel>=0.37
commands =
    python -m build --sdist --wheel

[testenv:install]
deps =
    build>=0.10
    setuptools>=61.0
    wheel>=0.37
commands =
    python -m build --sdist --wheel
    pip install dist/*.whl --force-reinstall
    python -c "import aiailint; print('Installation test passed')"
