{
  "installation_type": "btrfs_root",
  "version": "1.0",
  "description": "BTRFS Root Partition Installation Verification",
  "author": "Verified Installer Team",
  "created_date": "2023-12-18",
  "phases": [
    {
      "name": "boot_verification",
      "description": "Verify system booted successfully from BTRFS root subvolumes",
      "checks": [
        {
          "name": "root_filesystem",
          "description": "Root filesystem running from BTRFS subvolumes",
          "command": "mount | grep 'on / '",
          "expected_pattern": "btrfs.*subvol=/@",
          "severity": "critical",
          "validation_type": "output_pattern"
        },
        {
          "name": "btrfs_mounts",
          "description": "All BTRFS mount points are active",
          "command": "mount | grep btrfs | wc -l",
          "expected_pattern": "[1-9]",
          "severity": "informational",
          "validation_type": "output_pattern"
        }
      ]
    },
    {
      "name": "mount_verification",
      "description": "Verify expected mount points and subvolumes",
      "checks": [
        {
          "name": "home_mount",
          "description": "/home mounted with correct subvolume",
          "command": "mount | grep 'on /home '",
          "expected_pattern": "subvol=/@home",
          "severity": "critical",
          "validation_type": "output_pattern"
        },
        {
          "name": "var_log_mount",
          "description": "/var/log mounted with correct subvolume",
          "command": "mount | grep 'on /var/log '",
          "expected_pattern": "subvol=/@var-log",
          "severity": "informational",
          "validation_type": "output_pattern"
        },
        {
          "name": "var_cache_mount",
          "description": "/var/cache mounted with correct subvolume",
          "command": "mount | grep 'on /var/cache '",
          "expected_pattern": "subvol=/@var-cache",
          "severity": "informational",
          "validation_type": "output_pattern"
        },
        {
          "name": "var_tmp_mount",
          "description": "/var/tmp mounted with correct subvolume",
          "command": "mount | grep 'on /var/tmp '",
          "expected_pattern": "subvol=/@var-tmp",
          "severity": "informational",
          "validation_type": "output_pattern"
        },
        {
          "name": "var_spool_mount",
          "description": "/var/spool mounted with correct subvolume",
          "command": "mount | grep 'on /var/spool '",
          "expected_pattern": "subvol=/@var-spool",
          "severity": "informational",
          "validation_type": "output_pattern"
        },
        {
          "name": "var_backups_mount",
          "description": "/var/backups mounted with correct subvolume",
          "command": "mount | grep 'on /var/backups '",
          "expected_pattern": "subvol=/@var-backups",
          "severity": "informational",
          "validation_type": "output_pattern"
        }
      ]
    },
    {
      "name": "functionality_testing",
      "description": "Test BTRFS functionality including snapshots",
      "checks": [
        {
          "name": "snapshot_creation",
          "description": "Create test system snapshot",
          "command": "btrfs subvolume snapshot / /.snapshots/verification-test-$(date +%Y%m%d-%H%M)",
          "expected_pattern": "",
          "test_mode": true,
          "severity": "informational",
          "validation_type": "output_pattern"
        },
        {
          "name": "snapshot_cleanup",
          "description": "Remove test system snapshot",
          "command": "btrfs subvolume delete /.snapshots/verification-test-$(date +%Y%m%d-%H%M)",
          "expected_pattern": "",
          "test_mode": true,
          "severity": "informational",
          "validation_type": "output_pattern"
        }
      ]
    },
    {
      "name": "performance_analysis",
      "description": "Analyze BTRFS performance and compression",
      "checks": [
        {
          "name": "compression_analysis",
          "description": "Analyze compression effectiveness",
          "command": "compsize /",
          "expected_pattern": "",
          "optional": true,
          "severity": "informational",
          "validation_type": "output_pattern"
        },
        {
          "name": "filesystem_performance",
          "description": "Check filesystem performance",
          "command": "btrfs filesystem df / && btrfs filesystem usage /",
          "expected_pattern": "",
          "severity": "informational",
          "validation_type": "output_pattern"
        },
        {
          "name": "space_efficiency",
          "description": "Verify space efficiency",
          "command": "df -h / /home /var/log /var/cache /var/tmp /var/spool /var/backups",
          "expected_pattern": "",
          "severity": "informational",
          "validation_type": "output_pattern"
        }
      ]
    },
    {
      "name": "system_services",
      "description": "Verify critical system services",
      "checks": [
        {
          "name": "systemd_resolved",
          "description": "systemd-resolved service is active",
          "command": "systemctl is-active systemd-resolved",
          "expected_pattern": "active",
          "severity": "critical",
          "validation_type": "output_pattern"
        },
        {
          "name": "network_manager",
          "description": "NetworkManager service is active",
          "command": "systemctl is-active NetworkManager",
          "expected_pattern": "active",
          "severity": "critical",
          "validation_type": "output_pattern"
        },
        {
          "name": "boot_performance",
          "description": "Analyze boot performance",
          "command": "systemd-analyze blame | head -10",
          "expected_pattern": "",
          "severity": "informational",
          "validation_type": "output_pattern"
        }
      ]
    },
    {
      "name": "filesystem_integrity",
      "description": "Verify filesystem integrity and error checking",
      "checks": [
        {
          "name": "scrub_start",
          "description": "Start BTRFS scrub for data integrity",
          "command": "btrfs scrub start /",
          "expected_pattern": "",
          "test_mode": true,
          "severity": "informational",
          "validation_type": "output_pattern"
        },
        {
          "name": "scrub_status",
          "description": "Check BTRFS scrub status",
          "command": "btrfs scrub status /",
          "expected_pattern": "",
          "test_mode": true,
          "severity": "informational",
          "validation_type": "output_pattern"
        },
        {
          "name": "filesystem_errors",
          "description": "Check for recent filesystem errors",
          "command": "dmesg | grep -i error | tail -5",
          "expected_pattern": "",
          "severity": "informational",
          "validation_type": "output_pattern"
        }
      ]
    },
    {
      "name": "user_environment",
      "description": "Verify user environment and permissions",
      "checks": [
        {
          "name": "home_directory_access",
          "description": "User home directory is accessible",
          "command": "test -d $HOME && test -r $HOME && echo 'accessible'",
          "expected_pattern": "accessible",
          "severity": "critical",
          "validation_type": "output_pattern"
        },
        {
          "name": "home_directory_writable",
          "description": "Home directory is writable",
          "command": "touch $HOME/.test_write_$(date +%s) && rm $HOME/.test_write_$(date +%s) && echo 'writable'",
          "expected_pattern": "writable",
          "test_mode": true,
          "severity": "critical",
          "validation_type": "output_pattern"
        }
      ]
    },
    {
      "name": "subvolume_structure",
      "description": "Verify BTRFS subvolume structure",
      "checks": [
        {
          "name": "system_subvolumes",
          "description": "List system partition subvolumes",
          "command": "btrfs subvolume list /",
          "expected_pattern": "",
          "severity": "informational",
          "validation_type": "output_pattern"
        },
        {
          "name": "required_subvolumes",
          "description": "All required system subvolumes exist",
          "command": "btrfs subvolume list / | grep -E '(@|@home|@var-log|@var-cache|@var-tmp|@var-spool|@var-backups|@snapshots)' | wc -l",
          "expected_pattern": "[7-9]",
          "severity": "critical",
          "validation_type": "output_pattern"
        }
      ]
    },
    {
      "name": "final_assessment",
      "description": "Final system health assessment",
      "checks": [
        {
          "name": "filesystem_overview",
          "description": "Display BTRFS filesystem overview",
          "command": "btrfs filesystem show",
          "expected_pattern": "",
          "severity": "informational",
          "validation_type": "output_pattern"
        },
        {
          "name": "space_usage",
          "description": "Overall system space usage",
          "command": "df -h",
          "expected_pattern": "",
          "severity": "informational",
          "validation_type": "output_pattern"
        }
      ]
    }
  ],
  "mount_points": {
    "/": "subvol=/@",
    "/home": "subvol=/@home",
    "/var/log": "subvol=/@var-log",
    "/var/cache": "subvol=/@var-cache",
    "/var/tmp": "subvol=/@var-tmp",
    "/var/spool": "subvol=/@var-spool",
    "/var/backups": "subvol=/@var-backups"
  },
  "services": [
    "systemd-resolved",
    "NetworkManager"
  ],
  "filesystems": [
    "btrfs",
    "ext4"
  ],
  "test_operations": {
    "snapshot_test": {
      "command": "btrfs subvolume snapshot",
      "cleanup": "btrfs subvolume delete",
      "description": "Test snapshot functionality"
    },
    "scrub_test": {
      "command": "btrfs scrub start",
      "status": "btrfs scrub status",
      "description": "Test filesystem integrity"
    }
  },
  "dependencies": {
    "required_commands": [
      "btrfs",
      "mount",
      "systemctl",
      "df"
    ],
    "optional_commands": [
      "compsize",
      "systemd-analyze"
    ]
  },
  "post_verification": {
    "success_message": "BTRFS root partition installation verified successfully",
    "failure_message": "BTRFS root partition installation verification failed",
    "next_steps": [
      "Section S5: AI/ML BTRFS Environment Setup",
      "Section S6: Training Data Partition Configuration"
    ]
  }
}